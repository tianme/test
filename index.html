<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>javascript-demo</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    body {
      margin: 10px;
    }

    .textarea-box {
      display: flex;
    }

    button {
      padding: 5px;
    }

    #textarea {
      flex: 1;
      font-size: .16rem;
      height: 3rem;
      padding: 0.05rem;
    }

    .btns {
      display: flex;
      justify-content: space-between;
      padding: 20px;
    }
  </style>
  <script>
    (function () {
      var baseFontSize = 100;
      var baseWidth = 375;

      var set = function () {
        var clientWidth = document.documentElement.clientWidth || window.innerWidth;

        var rem = 100;
        if (clientWidth != baseWidth) {
          rem = Math.floor(clientWidth / baseWidth * baseFontSize);
        }

        document.querySelector('html').style.fontSize = rem + 'px';
      }
      set();

      window.addEventListener('resize', set);
    }());
  </script>
</head>

<body>
  <div>
    <div class="textarea-box">
      <textarea id="textarea"></textarea>
    </div>
    <div class="btns" >
      <button id="call-native-params">调用 Native 带参数</button>
      <button id="call-native">调用 Native 不带参数</button>
    </div>
  </div>
  <script>


    var textarea = document.querySelector('#textarea');
    var callNativeParams = document.querySelector('#call-native-params');
    var callNative = document.querySelector('#call-native');
    document.addEventListener('WebViewJavascriptBridgeReady', (event) => {
      event.bridge.init();
      // 注册方法
      event.bridge.registerHandler('ZDJSBridge_nativeCallJs', (res, responseCallback) => {
        textarea.value = `ZDJSBridge_nativeCallJs\n${JSON.stringify(res, null, 2)}`;
        responseCallback({
          code: '0',
          data: 'Javascript Says Right back aka!',
          message: '成功'
        });
      });
    });


    callNative.addEventListener('click', (e) => {

      window.WebViewJavascriptBridge.callHandler('ZDJSBridge_getLocation', null, (res) => {
        textarea.value = `common_native_get_location\n\n${JSON.stringify(res, null, 2)}`;
      });
    });
    callNativeParams.addEventListener('click', (e) => {
      var params = {
        message: 'hello world',
      }
      window.WebViewJavascriptBridge.callHandler('ZDJSBridge_getLocation', params,  (res) => {
        // res: { code: '0', data: { }, message: '' }
        textarea.value = `common_native_get_location\n\n${JSON.stringify(res, null, 2)}`;

      });
    });
    var noticeiOSInjectScript = () => {
      var iframe = document.createElement('iframe');

      iframe.src = 'https://__bridge_loaded__';
      iframe.style.display = 'none';

      document.body.appendChild(iframe);
      setTimeout(() => {
        document.body.removeChild(iframe);
      }, 0);
    }
    noticeiOSInjectScript();
  </script>
</body>

</html>
